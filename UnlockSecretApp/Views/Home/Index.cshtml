@{
    Layout = null;
}
<!doctype html>
<html lang="ru">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <title>💖 MiniApp — Ввод кода</title>

    <meta name="theme-color" content="#ffffff">
    <meta http-equiv="ScreenOrientation" content="autoRotate:disabled">
    <meta name="telegram-enable-debug" content="true">

    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="~/css/main.css" />
    <style>
        /* ТОЛЬКО специфические стили для Index.cshtml */
        html, body {
            height: 100dvh;
            min-height: 100dvh;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            background: linear-gradient(160deg,#f7fbff 0%,#fef7fb 50%,#f3f9ff 100%);
            color: #7c2a8d;
        }

       .background {
    position: fixed;
    inset: 0;
    background: url('/images/background.jpg') center/cover no-repeat;
    /* Убрать filter: blur() */
    filter: brightness(0.7); /* Только затемнение останется */
    z-index: 0;
}

        #container, .overlay {
            position: relative;
            z-index: 1;
        }

        .overlay {
            position: fixed;
            inset: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(15px);
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s ease, transform 0.5s ease;
            transform: scale(0.95);
        }

            .overlay.show {
                opacity: 1;
                pointer-events: all;
                transform: scale(1);
            }

            .overlay.hidden {
                display: none;
            }

        /* ОСТАВЬ ТОЛЬКО ЭТИ специфические стили */
        .title {
            font-family: 'Great Vibes', cursive;
            font-size: 2.2rem;
            color: #7c2a8d;
        }

        .congrats-title {
            font-family: 'Great Vibes', cursive;
            font-size: 2rem;
            font-weight: 800;
            color: #7c2a8d;
        }
    </style>
</head>

<body>
    <div class="background"></div>

    <main id="container">
        <h1 class="title">Введи секретный код</h1>

        <div class="inputs" aria-label="Код">
            <input type="text" inputmode="numeric" maxlength="2" class="code" value="" />
            <input type="text" inputmode="numeric" maxlength="2" class="code" value="" />
            <input type="text" inputmode="numeric" maxlength="2" class="code" value="" />
            
        </div>

        <div id="kitten" title="Свайпни вправо">
            <div class="swipe-bar"></div>
            <div class="kitten-inner">🐳</div>
            <div class="arrow"></div>
            <!-- Эффекты -->
            <div class="sparkle-effect"></div>
            <div class="glow-effect"></div>
        </div>



        <div id="message">Свайпни китёнка вправо, чтобы увидеть сюрприз</div>
    </main>

    <div id="loaderOverlay" class="overlay hidden">
        <div class="congrats-card glass">
            <div class="loading-text">Loading...</div>
        </div>
    </div>

    <!-- Поздравительные страницы -->
    <div id="page1" class="overlay hidden">
        <div class="congrats-card glass">
            <h2 class="congrats-title">С днём рождения 💖</h2>
            <pre id="typedText"><span id="typedCursor"></span></pre>
            <button class="btn-next" id="next1">Далее ➡️</button>
        </div>
    </div>
    <div id="page2" class="overlay hidden">
        <div class="congrats-card glass">
            <h2>💫 То, что делает тебя особенной</h2>
            <div class="scroll-indicator">⬇️ Листай вниз</div>
            <div id="page2Content" class="qualities-thoughts-container"></div>
            <button class="btn-next" id="next2" style="display: none;">Узнать больше 🌸</button>
        </div>
    </div>
    <div id="page3" class="overlay hidden">
        <div class="congrats-card glass">
            <h2>💌 Письмо в наше будущее</h2>
            <div id="futureLetter" class="future-letter"></div>
            <button class="btn-next" id="next3" style="display: none;">Прочитать финал 🌟</button>
        </div>
    </div>

    <div id="page4" class="overlay hidden">
        <div class="congrats-card glass">
            <h2>📸 Наши моменты</h2>

            <!-- Галерея -->
            <div class="gallery-container">
                <button class="gallery-arrow gallery-arrow-prev">❮</button>

                <div class="gallery-slide">
                    <img id="galleryImage" src="" alt="Наше фото" class="gallery-image">
                    <div id="galleryCaption" class="gallery-caption"></div>
                </div>

                <button class="gallery-arrow gallery-arrow-next">❯</button>
            </div>

            <div class="gallery-indicator">
                <span id="currentIndex">1</span> / <span id="totalImages">0</span>
            </div>

            <button class="btn-next" id="next4">Завершить 🌟</button>
        </div>
    </div>

    <script>
                      (() => {
            const inputs = [...document.querySelectorAll('.code')];
            const kitten = document.getElementById('kitten');
            const swipeBar = kitten.querySelector('.swipe-bar');
            const kittenInner = kitten.querySelector('.kitten-inner');
            const sparkleEffect = kitten.querySelector('.sparkle-effect');
            const glowEffect = kitten.querySelector('.glow-effect');
            const message = document.getElementById('message');
            const correctCode = ['20','05','10'];
            // Добавляем после showPage3WithAnimation()

function showPage4WithAnimation() {
    const page4 = document.getElementById('page4');
    page4.classList.remove('hidden');
    setTimeout(() => page4.classList.add('show'), 50);
    
    // Инициализируем галерею
    initGallery();
}

// Данные для галереи (замените на ваши фото и подписи)
// Альтернативные данные с placeholder изображениями
const galleryData = [
    {
        image: 'https://via.placeholder.com/400x300/FF69B4/FFFFFF?text=Наша+первая+встреча',
        caption: 'Наша первая встреча... Помнишь, как все начиналось? 💫'
    },
    {
        image: 'https://via.placeholder.com/400x300/9370DB/FFFFFF?text=Особенные+моменты',
        caption: 'Тот день, когда я понял - ты особенная... ✨'
    },
    {
        image: 'https://via.placeholder.com/400x300/20B2AA/FFFFFF?text=Совместные+мечты',
        caption: 'Наши совместные мечты и планы... 🌸'
    }
];
let currentGalleryIndex = 0;

function initGallery() {
    const galleryImage = document.getElementById('galleryImage');
    const galleryCaption = document.getElementById('galleryCaption');
    const currentIndexSpan = document.getElementById('currentIndex');
    const totalImagesSpan = document.getElementById('totalImages');
    
    // Устанавливаем общее количество фото
    totalImagesSpan.textContent = galleryData.length;
    
    // Показываем первое фото
    showGalleryImage(0);
    
    // Обработчики для стрелок
    document.querySelector('.gallery-arrow-prev').addEventListener('click', () => {
        currentGalleryIndex = (currentGalleryIndex - 1 + galleryData.length) % galleryData.length;
        showGalleryImage(currentGalleryIndex, 'prev');
    });
    
    document.querySelector('.gallery-arrow-next').addEventListener('click', () => {
        currentGalleryIndex = (currentGalleryIndex + 1) % galleryData.length;
        showGalleryImage(currentGalleryIndex, 'next');
    });
    
    // Добавляем обработчики свайпов для мобильных
    let startX = 0;
    const gallerySlide = document.querySelector('.gallery-slide');
    
    gallerySlide.addEventListener('touchstart', (e) => {
        startX = e.touches[0].clientX;
    });
    
    gallerySlide.addEventListener('touchend', (e) => {
        if (!startX) return;
        
        const endX = e.changedTouches[0].clientX;
        const diffX = startX - endX;
        
        if (Math.abs(diffX) > 50) { // Минимальное расстояние свайпа
            if (diffX > 0) {
                // Свайп влево - следующее фото
                currentGalleryIndex = (currentGalleryIndex + 1) % galleryData.length;
                showGalleryImage(currentGalleryIndex, 'next');
            } else {
                // Свайп вправо - предыдущее фото
                currentGalleryIndex = (currentGalleryIndex - 1 + galleryData.length) % galleryData.length;
                showGalleryImage(currentGalleryIndex, 'prev');
            }
        }
        
        startX = 0;
    });
    
    function showGalleryImage(index, direction = 'next') {
        const data = galleryData[index];
        
        // Добавляем класс анимации
        galleryImage.classList.add(direction === 'next' ? 'slide-next' : 'slide-prev');
        galleryCaption.classList.add(direction === 'next' ? 'slide-next' : 'slide-prev');
        
        // Устанавливаем фото и подпись
        galleryImage.src = data.image;
        galleryImage.alt = `Наше фото ${index + 1}`;
        galleryCaption.textContent = data.caption;
        
        // Обновляем индикатор
        currentIndexSpan.textContent = index + 1;
        
        // Убираем классы анимации после завершения
        setTimeout(() => {
            galleryImage.classList.remove('slide-next', 'slide-prev');
            galleryCaption.classList.remove('slide-next', 'slide-prev');
        }, 500);
    }
}

// Обновляем обработчики
document.getElementById("next3").addEventListener('click', () => showPage4WithAnimation());

// Обработчик для завершающей кнопки
document.getElementById("next4").addEventListener('click', () => {
    // Можно добавить финальную анимацию или сообщение
    alert('Спасибо, что прошла весь этот путь со мной! 💖');
    // Или перезагрузить приложение
    // location.reload();
});

                    // Добавляем после функции showPage2WithAnimation()

                function showPage3WithAnimation() {
            const page3 = document.getElementById('page3');
            const letterContainer = document.getElementById('futureLetter');
            const nextButton = document.getElementById('next3');

            page3.classList.remove('hidden');
            setTimeout(() => page3.classList.add('show'), 50);

            // Скрываем кнопку пока письмо пишется
            nextButton.style.display = 'none';
            letterContainer.innerHTML = '';

            // Содержимое письма с заголовками и скрытым текстом
            const letterSections = [
                {
                    title: "📝 Начало...",
                    hiddenText: "Моя любимая... Я пишу тебе это письмо в день твоего рождения, но адресую его в наше будущее. Когда ты будешь это читать, знай — в этот момент я думаю о тебе так же сильно, как и сейчас."
                },
                {
                    title: "💭 О настоящем",
                            hiddenText: "Сейчас, глядя на тебя, я понимаю, как мне повезло.С каждым днем я понимал — ты не просто человек. Ты — та самая, которую я искал всю жизнь. Твоя улыбка, твой смех, твой взгляд — всё это стало для меня 'всем'. Ты — для меня та самая 'искорка' ,каждый момент с тобой — это подарок."
                },
                {
                    title: "✨ Наши мечты",
                    hiddenText: "Я верю, что нас ждут удивительные приключения."
                },
                {
                    title: "🛡️ Обещания",
                    hiddenText: "Я обещаю всегда быть твоей опорой. Поддерживать в любых начинаниях, верить в тебя даже когда ты сомневаешься, любить тебя сильнее с каждым днём."
                },
                {
                    title: "❤️ Главное",
                    hiddenText: "Ты — моё счастье, моя надежда, моя любовь. Тот человек, ради которого хочется становиться лучше. Тот свет, который освещает даже самые тёмные дни."
                },
                {
                    title: "💫 Будущее",
                    hiddenText: "Я не знаю, что ждёт нас впереди, но знаю точно — я хочу идти туда только с тобой. Рука об руку, сердце к сердцу. Навсегда твой..."
                }
            ];

            let currentSection = 0;

            function createNextSection() {
                if (currentSection < letterSections.length) {
                    const section = letterSections[currentSection];

                    // Создаем элемент секции
                    const sectionElement = document.createElement('div');
                    sectionElement.className = 'letter-section';
                    sectionElement.style.opacity = '0';
                    sectionElement.style.transform = 'translateY(20px)';

                    // Заголовок (кликабельный)
                    const titleElement = document.createElement('div');
                    titleElement.className = 'letter-section-title';
                    titleElement.innerHTML = `
                        <span class="section-emoji">${section.title.split(' ')[0]}</span>
                        <span class="section-text">${section.title.substring(section.title.indexOf(' ') + 1)}</span>
                        <span class="section-arrow">▼</span>
                    `;

                    // Скрытый текст
                    const contentElement = document.createElement('div');
                    contentElement.className = 'letter-section-content';
                    contentElement.innerHTML = section.hiddenText;
                    contentElement.style.display = 'none';

                    // Обработчик клика
                    titleElement.addEventListener('click', () => {
                        const isOpen = contentElement.style.display === 'block';
                        contentElement.style.display = isOpen ? 'none' : 'block';
                        titleElement.querySelector('.section-arrow').textContent = isOpen ? '▼' : '▲';

                        // Анимация раскрытия
                        if (!isOpen) {
                            contentElement.style.opacity = '0';
                            contentElement.style.transform = 'translateY(-10px)';
                            setTimeout(() => {
                                contentElement.style.transition = 'all 0.4s ease';
                                contentElement.style.opacity = '1';
                                contentElement.style.transform = 'translateY(0)';
                            }, 10);
                        }
                    });

                    sectionElement.appendChild(titleElement);
                    sectionElement.appendChild(contentElement);
                    letterContainer.appendChild(sectionElement);

                    // Анимация появления секции
                    setTimeout(() => {
                        sectionElement.style.transition = 'all 0.8s ease';
                        sectionElement.style.opacity = '1';
                        sectionElement.style.transform = 'translateY(0)';
                    }, 100);

                    currentSection++;

                    // Задержка между появлением секций
                    setTimeout(createNextSection, 800);
                } else {
                    // Все секции созданы, показываем кнопку
                    setTimeout(() => {
                        nextButton.style.display = 'block';
                        nextButton.style.animation = 'fadeIn 0.5s ease';

                        // Добавляем финальное сообщение
                        const finalMessage = document.createElement('div');
                        finalMessage.className = 'letter-final';
                        finalMessage.innerHTML = '💖 Прочитай каждое письмо... Они все для тебя ✨';
                        finalMessage.style.textAlign = 'center';
                        finalMessage.style.marginTop = '2rem';
                        finalMessage.style.fontStyle = 'italic';
                        finalMessage.style.color = '#ff69b4';
                        finalMessage.style.animation = 'pulse 2s infinite';
                        letterContainer.appendChild(finalMessage);
                    }, 1000);
                }
            }

            // Начинаем создание секций
            setTimeout(createNextSection, 500);
        }

        // Обновляем обработчики
        document.getElementById("next2").addEventListener('click', () => showPage3WithAnimation());

                      const page2Content = [
                        {
                            emoji: "😊",
                            title: "Твоя улыбка",
                            description: "Когда ты улыбаешься, весь мир становится ярче. Твоя улыбка — это не просто движение губ, это искреннее выражение души, которое способно растопить даже самое холодное сердце. Она уникальна и неповторима, как и ты сама.",
                            thought: "Помнишь тот день, когда я сказал о твоей улыбке? Это было как луч солнца в пасмурный день. С тех пор я мечтаю видеть её каждый день."
                        },
                        {
                            emoji: "💫",
                            title: "Моя искорка",
                            description: "Ты зажгла во мне огонь, о котором я даже не мечтал. До встречи с тобой моя жизнь была как чёрно-белое кино, а ты принесла в неё все цвета радуги. Ты превратила обычные дни в праздники, а простые моменты — в волшебные воспоминания.",
                            thought: "Ты стала тем самым человеком, ради которого хочется просыпаться каждый день. Ты превратила моё существование в настоящую, полноценную жизнь."
                        },
                        {
                            emoji: "🤗",
                            title: "Твоя забота",
                            description: "Ты всегда чувствуешь, когда мне тяжело, и находишь нужные слова. Твоя поддержка — это не просто слова, это настоящее тепло, которое согревает даже в самые трудные моменты. Ты умеешь слушать, понимать и быть рядом, когда это действительно важно.",
                            thought: "Твоя поддержка стала для меня надёжным якорем в бурном море жизни. Спасибо, что всегда находишь нужные слова в нужный момент."
                        }
                    ];

        function showPage2WithAnimation() {
            const page2 = document.getElementById('page2');
            const contentContainer = document.getElementById('page2Content');
            const nextButton = document.getElementById('next2');

            page2.classList.remove('hidden');
            setTimeout(() => page2.classList.add('show'), 50);

            nextButton.style.display = 'none';
            contentContainer.innerHTML = '';

            let delay = 0;

          

            // Добавляем обработчик скролла для кнопки
            const checkScroll = () => {
                const container = contentContainer;
                const isAtBottom = container.scrollHeight - container.scrollTop <= container.clientHeight + 10;

                if (isAtBottom) {
                    nextButton.style.display = 'block';
                    nextButton.style.animation = 'fadeIn 0.5s ease';
                    container.removeEventListener('scroll', checkScroll);
                }
            };

            // Альтернатива: показываем кнопку через время + слушаем скролл
            setTimeout(() => {
                nextButton.style.display = 'block';
                nextButton.style.animation = 'fadeIn 0.5s ease';

                // Добавляем скролл проверку на всякий случай
                contentContainer.addEventListener('scroll', checkScroll);
            }, delay + 500);

            // Авто-скролл к новому элементу при добавлении
            let lastAddedElement = null;
            page2Content.forEach((item, index) => {
                setTimeout(() => {
                    const qualityItem = document.createElement('div');
                    qualityItem.className = 'quality-thought-item';
                    qualityItem.innerHTML = `
                        <div class="quality-header">
                            <span class="quality-emoji">${item.emoji}</span>
                            <div class="quality-title">${item.title}</div>
                        </div>
                        <div class="quality-description">${item.description}</div>
                        <div class="personal-thought">${item.thought}</div>
                    `;

                    contentContainer.appendChild(qualityItem);
                    lastAddedElement = qualityItem;

                    // Плавный скролл к новому элементу
                    setTimeout(() => {
                        qualityItem.classList.add('visible');
                        if (qualityItem.offsetTop > contentContainer.clientHeight) {
                            qualityItem.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                        }
                    }, 100);

                }, index * 800);
            });
        }

        // Обновляем обработчик
        document.getElementById("next1").addEventListener('click', () => showPage2WithAnimation());
                    // Функция для эффекта печатания текста
        function typeWriter(text, element, speed = 40, callback = null) {
            let i = 0;
            element.innerHTML = '';

            function type() {
                if (i < text.length) {
                    // Обрабатываем специальные теги
                    if (text.substring(i, i + 6) === '<wait>') {
                        i += 6;
                        setTimeout(type, 500);
                        return;
                    }

                    if (text.substring(i, i + 8) === '<number>') {
                        i += 8;
                        const numEnd = text.indexOf('</number>', i);
                        if (numEnd !== -1) {
                            const number = text.substring(i, numEnd);
                            element.innerHTML += `<span class="highlight-number">${number}</span>`;
                            i = numEnd + 9;
                        }
                    } else {
                        element.innerHTML += text.charAt(i);
                        i++;
                    }

                    // Добавляем мигающий курсор
                    const cursor = document.createElement('span');
                    cursor.className = 'typed-cursor';
                    element.appendChild(cursor);

                    setTimeout(() => {
                        if (cursor.parentNode) {
                            cursor.parentNode.removeChild(cursor);
                        }
                        type();
                    }, speed);
                } else {
                    // Текст напечатан
                    if (callback) callback();
                }
            }
            type();
        }

               const page1Content = `За этими цифрами — наша история...<wait>

        Каждое число хранит воспоминания:<wait>

               <number>20</number> 🌙<wait>
        День, когда вселенная подмигнула<wait>
        Наши первые "привет", встречи, взгляды<wait>

        <number>05</number> 💫<wait>
        День, когда судьба сказала "да"<wait>
        День, когда ты стала моей половинкой<wait>

        <number>10</number> 💖<wait>
        День, когда тишина закричала любовью<wait>
        День, когда сердце перестало молчать<wait>


        Готова продолжить? 💫`;

        // Показ первой страницы с анимацией
        function showPage1WithAnimation() {
            const page1 = document.getElementById('page1');
            const typedText = document.getElementById('typedText');
            const nextButton = document.getElementById('next1');

            page1.classList.remove('hidden');
            setTimeout(() => page1.classList.add('show'), 50);

            // Скрываем кнопку пока текст печатается
            nextButton.style.display = 'none';

            // Запускаем печать текста
            typeWriter(page1Content, typedText, 30, () => {
                // Когда текст напечатан, показываем кнопку
                setTimeout(() => {
                    nextButton.style.display = 'block';
                    nextButton.style.animation = 'fadeIn 0.5s ease';
                }, 500);
            });
        }

            // Добавляем пульсацию когда готов к свайпу
            kitten.classList.add('ready-pulse');

            // ----------- INPUT CODE HANDLING -------------
            inputs.forEach((inp, i) => {
                inp.addEventListener('focus', () => {
                    if (inp.value === '00') inp.value = '';
                    createParticles(inp);
                });

                inp.addEventListener('blur', () => {
                    if (inp.value === '') inp.value = '00';
                });

                inp.addEventListener('input', e => {
                    e.target.value = e.target.value.replace(/\D/g, '').slice(0, 2);

                    if (e.target.value.length === 2 && i < inputs.length - 1) {
                        setTimeout(() => inputs[i + 1].focus(), 10);
                    }

                    // Эффект при вводе (без сдвига)
                    if (e.target.value.length > 0) {
                        e.target.style.transform = 'scale(1.1)';
                        setTimeout(() => {
                            if (e.target) e.target.style.transform = 'scale(1)';
                        }, 150);
                    }
                });

                // Backspace handling
                inp.addEventListener('keydown', e => {
                    if (e.key === 'Backspace' && e.target.value === '' && i > 0) {
                        setTimeout(() => inputs[i - 1].focus(), 10);
                    }
                });
            });

            // ----------- SWIPE HANDLING -------------
            let startX = 0;
            let isSwiping = false;
            let animationFrameId = null;

            const handleSwipeMove = (e) => {
                if (!isSwiping || startX === 0) return;

                const dx = Math.max(0, e.clientX - startX);
                const progress = Math.min(100, dx / 1.5);

                // Используем requestAnimationFrame для плавности
                if (animationFrameId) {
                    cancelAnimationFrame(animationFrameId);
                }

                animationFrameId = requestAnimationFrame(() => {
                    // заполнение полосы
                    swipeBar.style.width = progress + '%';

                    // движение китёнка
                    kittenInner.style.left = Math.min(dx / 1.5, 120) + 'px';

                    // эффект свечения
                    glowEffect.style.width = progress + '%';
                    sparkleEffect.style.opacity = Math.min(progress / 100, 0.7);

                    // вибрация при сильном свайпе
                    if (progress > 70 && progress % 20 < 5) {
                        createParticlesAroundKitten();
                    }
                });
            };

            kitten.addEventListener('pointerdown', e => {
                startX = e.clientX;
                isSwiping = true;
                kitten.setPointerCapture(e.pointerId);
                kitten.style.cursor = 'grabbing';
                kitten.classList.remove('ready-pulse');

                // Эффект при начале свайпа
                createWave(e.clientX, e.clientY);

                // Добавляем обработчик движения
                kitten.addEventListener('pointermove', handleSwipeMove);
            });

            kitten.addEventListener('pointerup', (e) => {
                if (!isSwiping) return;

                // Убираем обработчик движения
                kitten.removeEventListener('pointermove', handleSwipeMove);

                if (animationFrameId) {
                    cancelAnimationFrame(animationFrameId);
                    animationFrameId = null;
                }

                const dx = e.clientX - startX;

                if (dx > 100) {
                    const userCode = inputs.map(inp => inp.value.padStart(2, '0'));

                    if (!userCode.every((v, i) => v === correctCode[i])) {
                        wrongCodeAnimation();
                    } else {
                        correctCodeAnimation();
                    }
                } else {
                    // Не дотянул - плавный возврат
                    resetSwipeWithAnimation();
                }

                isSwiping = false;
                startX = 0;
            });

            // Обработчик отмены свайпа (например, выход за пределы)
            kitten.addEventListener('pointercancel', () => {
                if (isSwiping) {
                    kitten.removeEventListener('pointermove', handleSwipeMove);
                    if (animationFrameId) {
                        cancelAnimationFrame(animationFrameId);
                        animationFrameId = null;
                    }
                    resetSwipeWithAnimation();
                    isSwiping = false;
                    startX = 0;
                }
            });

            // ----------- ANIMATIONS -----------

            function createParticles(element) {
                const rect = element.getBoundingClientRect();
                for (let i = 0; i < 3; i++) { // Меньше частиц для производительности
                    setTimeout(() => {
                        const particle = document.createElement('div');
                        particle.className = 'particle';
                        particle.style.left = rect.left + rect.width / 2 + 'px';
                        particle.style.top = rect.top + rect.height / 2 + 'px';
                        particle.style.setProperty('--tx', (Math.random() - 0.5) * 40 + 'px');
                        particle.style.setProperty('--ty', (Math.random() - 0.5) * 40 + 'px');
                        particle.style.background = i % 2 === 0 ? '#ff69b4' : '#9370db';
                        document.body.appendChild(particle);

                        setTimeout(() => {
                            if (particle.parentNode) {
                                particle.parentNode.removeChild(particle);
                            }
                        }, 800);
                    }, i * 100);
                }
            }

            function createParticlesAroundKitten() {
                const rect = kitten.getBoundingClientRect();
                for (let i = 0; i < 2; i++) { // Меньше частиц
                    const particle = document.createElement('div');
                    particle.className = 'particle';
                    particle.style.left = rect.right - 20 + 'px';
                    particle.style.top = rect.top + Math.random() * rect.height + 'px';
                    particle.style.setProperty('--tx', (Math.random() * 30 + 10) + 'px');
                    particle.style.setProperty('--ty', (Math.random() - 0.5) * 30 + 'px');
                    particle.style.background = '#ff69b4';
                    document.body.appendChild(particle);

                    setTimeout(() => {
                        if (particle.parentNode) {
                            particle.parentNode.removeChild(particle);
                        }
                    }, 800);
                }
            }

            function createWave(x, y) {
                const wave = document.createElement('div');
                wave.className = 'wave';
                wave.style.left = x + 'px';
                wave.style.top = y + 'px';
                document.body.appendChild(wave);

                setTimeout(() => {
                    if (wave.parentNode) {
                        wave.parentNode.removeChild(wave);
                    }
                }, 400);
            }

                   function correctCodeAnimation() {
            message.textContent = 'Ура! Правильно! 💖';

            // Эффект успеха
            kitten.classList.add('success-glow');
            createParticlesAroundKitten();

            inputs.forEach(inp => inp.blur());

            setTimeout(() => {
                document.getElementById('container').classList.add('fade-out-scale');
                setTimeout(() => showPage1WithAnimation(), 500);
            }, 1000);
        }


            function wrongCodeAnimation() {
                message.textContent = 'Неверный код! Попробуй ещё 🌸';

                // Анимация ошибки
                kitten.classList.add('shake');
                setTimeout(() => kitten.classList.remove('shake'), 500);

                resetSwipeWithAnimation();
            }

            function resetSwipeWithAnimation() {
                // Плавный возврат с транзишенами
                swipeBar.style.transition = 'width 0.3s cubic-bezier(0.4, 0, 0.2, 1)';
                kittenInner.style.transition = 'left 0.3s cubic-bezier(0.4, 0, 0.2, 1)';
                glowEffect.style.transition = 'width 0.3s cubic-bezier(0.4, 0, 0.2, 1)';
                sparkleEffect.style.transition = 'opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1)';

                swipeBar.style.width = '0%';
                kittenInner.style.left = '10px';
                glowEffect.style.width = '0%';
                sparkleEffect.style.opacity = '0';

                setTimeout(() => {
                    swipeBar.style.transition = '';
                    kittenInner.style.transition = '';
                    glowEffect.style.transition = '';
                    sparkleEffect.style.transition = '';
                    kitten.style.cursor = 'pointer';
                    kitten.classList.add('ready-pulse');
                }, 300);
            }

            // ----------- PAGE HANDLING -----------
            function showPage(pageId) {
                const pages = ['page1', 'page2', 'page3', 'page4'];

                pages.forEach(id => {
                    const el = document.getElementById(id);

                    if (id === pageId) {
                        el.classList.remove("hidden");
                        setTimeout(() => el.classList.add("show"), 30);
                    } else {
                        el.classList.remove("show");
                        setTimeout(() => el.classList.add("hidden"), 300);
                    }
                });
            }

            document.getElementById("next1").addEventListener('click', () => showPage("page2"));
            document.getElementById("next2").addEventListener('click', () => showPage("page3"));
            document.getElementById("next3").addEventListener('click', () => showPage("page4"));

            // auto-focus first input
            setTimeout(() => inputs[0].focus(), 100);

        })();
                // ДОБАВЬ ПОСЛЕ ВСЕГО ОСТАЛЬНОГО КОДА В КОНЦЕ ФУНКЦИИ
        // ========== FIX FOR MOBILE INPUT POSITION ==========

        // Функция для принудительного фиксирования позиции inputs
        function fixMobileInputs() {
            const inputs = document.querySelectorAll('.code');

            inputs.forEach(input => {
                // При фокусе фиксируем позицию
                input.addEventListener('focus', function() {
                    this.style.position = 'relative';
                    this.style.top = '0';
                    this.style.left = '0';
                    this.style.transform = 'scale(1.05)';
                    this.style.zIndex = '100';
                });

                // При потере фокуса
                input.addEventListener('blur', function() {
                    this.style.transform = 'scale(1)';
                    this.style.zIndex = '1';
                });

                // При вводе
                input.addEventListener('input', function() {
                    // Принудительно устанавливаем высоту строки
                    this.style.lineHeight = this.offsetHeight + 'px';
                });
            });

            // Принудительно устанавливаем правильную высоту line-height
            setTimeout(() => {
                inputs.forEach(input => {
                    if (input.offsetHeight > 0) {
                        input.style.lineHeight = input.offsetHeight + 'px';
                    }
                });
            }, 100);

            // Пересчитываем при изменении размера экрана
            window.addEventListener('resize', () => {
                setTimeout(() => {
                    inputs.forEach(input => {
                        if (input.offsetHeight > 0) {
                            input.style.lineHeight = input.offsetHeight + 'px';
                        }
                    });
                }, 100);
            });
        }

        // Вызываем функцию после загрузки
        setTimeout(fixMobileInputs, 500);
    </script>
</body>
</html>

